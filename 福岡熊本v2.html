<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ—ä¹å·è–èª•è·¨å¹´ä¹‹æ—… - è¡Œç¨‹åŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* ã€MUJI STYLE å®šç¾©é¡è‰²è®Šæ•¸ã€‘ */
        :root {
            --muji-brown: #A5745A; /* ä¸»æœ¨æ£•è‰² */
            --muji-green: #6F9D9C; /* æŸ”å’Œç°ç¶ è‰² */
        }

        /* æ™‚é–“è»¸æ¨£å¼ */
        .timeline-item {
            position: relative;
            padding-left: 20px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -10px;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background-color: var(--muji-brown); /* æœ¨æ£•è‰²åœ“é» */
            border-radius: 50%;
            z-index: 10;
        }

        /* æ™‚é–“è»¸ç·šæ¢ */
        .timeline-container {
            border-left: 2px solid var(--muji-brown); /* æœ¨æ£•è‰²ç·šæ¢ */
            padding-left: 10px;
        }

        /* æ—¥æœŸæŒ‰éˆ•æ¨£å¼ */
        .date-btn {
            font-size: 0.75rem; /* text-xs */
            padding-top: 0.35rem; /* py-1 */
            padding-bottom: 0.35rem; /* py-1 */
            padding-left: 0.65rem; /* px-2 */
            padding-right: 0.65rem; /* px-2 */
        }

        .active-date {
            background-color: var(--muji-brown) !important;
            color: white !important;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* åº•éƒ¨å°èˆªæ¬„æ¨£å¼ */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background-color: white;
            border-top: 1px solid #e5e7eb;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.05);
            z-index: 50;
        }

        .active-tab-icon {
            color: var(--muji-brown);
        }

        .hidden {
            display: none;
        }
        
        /* å¤©æ°£å¡ç‰‡æ¨£å¼ */
        .weather-card {
            background-color: #ffffff; /* ç™½è‰²èƒŒæ™¯ */
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        }
        .weather-city {
            font-weight: bold;
            color: var(--muji-brown);
        }
    </style>
</head>
<body class="bg-gray-50 pb-16">

    <header class="bg-white p-4 shadow-md sticky top-0 z-40">
        <h1 class="text-xl font-bold text-center text-gray-800">åŒ—ä¹å·è–èª•è·¨å¹´ä¹‹æ—… (12/26 - 12/31)</h1>
    </header>
    
    <div class="p-4 max-w-md mx-auto">

        <section class="weather-card">
            <h2 class="text-lg font-bold text-gray-700 mb-3 flex items-center">
                <i class="fa-solid fa-cloud-sun text-[#6F9D9C] mr-2"></i> è¡Œç¨‹å¤©æ°£ç¸½è¦½ (tenki.jp)
            </h2>
            <div id="weather-summary" class="grid grid-cols-3 gap-3 text-center text-sm mb-4">
                </div>
            
            <div class="flex justify-center mt-3">
                <a href="https://tenki.jp/week/9/48/801/40130/" target="_blank" class="bg-[#6F9D9C] text-white text-sm font-semibold py-2 px-4 rounded-lg hover:bg-teal-700 transition duration-150 ease-in-out flex items-center shadow">
                    <i class="fa-solid fa-arrow-up-right-from-square mr-2"></i> é»æ“ŠæŸ¥çœ‹ tenki.jp è©³ç´°é å ±
                </a>
            </div>
        </section>
        
        <div id="date-buttons" class="flex flex-wrap gap-2 justify-center py-3 mb-4 sticky top-40 bg-gray-50 z-30 border-b border-gray-200 shadow-sm">
            </div>

        <div id="tab-plan" class="tab-content">
            <h2 class="text-lg font-bold text-gray-700 mb-4 flex items-center">
                <i class="fa-solid fa-calendar-days text-[#A5745A] mr-2"></i> è¡Œç¨‹ç¸½è¦½
            </h2>

            <div class="mb-6">
                <button id="toggle-add-event-form" class="w-full bg-[#6F9D9C] text-white p-2 rounded-lg font-bold hover:bg-teal-700 transition duration-150 ease-in-out flex items-center justify-center shadow-md">
                    <i class="fa-solid fa-circle-plus mr-2"></i> æ–°å¢è¡Œç¨‹é …ç›®
                </button>
                
                <form id="add-event-form" class="hidden mt-3 bg-white p-4 rounded-lg shadow border border-[#6F9D9C]">
                    <h4 class="font-bold text-gray-700 mb-3 text-center border-b pb-2">æ–°å¢è¡Œç¨‹ç´°ç¯€</h4>
                    <div class="space-y-3">
                        <select id="new-event-date" class="w-full p-2 border rounded-lg text-sm bg-gray-50" required>
                            <option value="" disabled selected>é¸æ“‡æ—¥æœŸ</option>
                        </select>
                        <div class="flex space-x-2">
                            <input type="time" id="new-event-time" class="w-1/3 p-2 border rounded-lg text-sm" required>
                            <input type="text" id="new-event-icon" placeholder="åœ–ç¤º (fa-solid fa-...)" class="w-2/3 p-2 border rounded-lg text-sm" value="fa-circle-check">
                        </div>
                        <input type="text" id="new-event-title" placeholder="è¡Œç¨‹æ¨™é¡Œ (å¦‚ï¼šæ™šé¤)" class="w-full p-2 border rounded-lg text-sm" required>
                        <input type="text" id="new-event-note" placeholder="å‚™è¨» (å¦‚ï¼šé˜¿è˜‡èµ¤ç‰›ä¸¼/é£¯åº—)" class="w-full p-2 border rounded-lg text-sm">
                    </div>
                    <button type="submit" class="w-full mt-4 bg-[#A5745A] text-white p-2 rounded-lg text-sm font-semibold hover:bg-stone-600">ç¢ºèªæ–°å¢</button>
                </form>
            </div>
            
            <div id="itinerary-container" class="mb-8">
                <p class="text-gray-500 text-center py-4">è«‹é»æ“Šä¸Šæ–¹çš„æ—¥æœŸæŒ‰éˆ•æŸ¥çœ‹æ¯æ—¥è¡Œç¨‹ã€‚</p>
            </div>


            <section class="mb-6 bg-white p-4 rounded-lg shadow-md border-2 border-[#6F9D9C]">
                <h3 class="text-base font-semibold text-gray-700 mb-4 flex items-center">
                    <i class="fa-solid fa-money-bill-transfer text-[#6F9D9C] mr-2"></i> ç°¡æ˜“è¨˜å¸³æœ¬
                </h3>
                
                <form id="expense-form" class="mb-4">
                    <div class="flex space-x-2 mb-2">
                        <select id="expense-date" class="w-1/3 p-2 border rounded-lg text-sm bg-white" required>
                            <option value="" disabled selected>æ—¥æœŸ</option>
                        </select>
                        <select id="expense-category" class="w-1/3 p-2 border rounded-lg text-sm bg-white" required>
                            <option value="" disabled selected>åˆ†é¡</option>
                            <option value="é¤é£Ÿ">é¤é£Ÿ</option>
                            <option value="äº¤é€š">äº¤é€š</option>
                            <option value="è—¥å¦">è—¥å¦</option>
                            <option value="ä½å®¿">ä½å®¿</option>
                            <option value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                        <select id="expense-payment" class="w-1/3 p-2 border rounded-lg text-sm bg-white" required>
                            <option value="" disabled selected>ä»˜æ¬¾</option>
                            <option value="PayPay">PayPay</option>
                            <option value="ç¾é‡‘">ç¾é‡‘</option>
                            <option value="ä¿¡ç”¨å¡">ä¿¡ç”¨å¡</option>
                        </select>
                    </div>
                    <div class="flex space-x-2">
                        <input type="text" id="expense-title" placeholder="é …ç›®" class="w-1/3 p-2 border rounded-lg text-sm" required>
                        <input type="number" id="expense-amount" placeholder="é‡‘é¡ (JPY)" class="flex-grow p-2 border rounded-lg text-sm text-right" required>
                        <button type="submit" class="w-1/4 bg-[#A5745A] text-white p-2 rounded-lg text-sm hover:bg-stone-600">æ–°å¢</button>
                    </div>
                </form>

                <div class="flex justify-between items-center border-t pt-4 mt-2">
                    <span class="text-sm font-bold text-gray-700">è¨˜å¸³æ¸…å–® (JPY)</span>
                    <select id="expense-filter-date" onchange="renderExpenses()" class="p-1 border rounded-lg text-xs bg-white">
                        <option value="ALL">é¡¯ç¤ºå…¨éƒ¨</option>
                    </select>
                </div>
                
                <div id="expense-list" class="space-y-2 mb-4 max-h-52 overflow-y-auto pt-2">
                </div>

                <div class="border-t pt-4">
                    <div id="category-totals" class="space-y-1 mb-3">
                        <p class="font-bold text-gray-800 text-sm border-b pb-1">å„åˆ†é¡ç¸½è¨ˆ (JPY)</p>
                    </div>
                    <div id="payment-totals" class="space-y-1 mb-3">
                        <p class="font-bold text-gray-800 text-sm border-b pb-1">ä»˜æ¬¾æ–¹å¼ç¸½è¨ˆ (JPY)</p>
                    </div>

                    <div class="flex justify-between font-bold text-gray-800">
                        <span>ç¸½æ”¯å‡º (JPY)</span>
                        <span id="total-jpy">0</span>
                    </div>
                    <div class="flex justify-between text-sm text-gray-600 mt-1">
                        <span>ç¸½æ”¯å‡º (TWD) @22.0</span>
                        <span id="total-twd">0</span>
                    </div>
                </div>
            </section>


            <h2 class="text-lg font-bold text-gray-700 mb-4 flex items-center border-b pb-2 mt-8">
                <i class="fa-solid fa-list-check text-[#6F9D9C] mr-2"></i> è¡Œç¨‹è¼”åŠ©æ¸…å–®èˆ‡è³‡è¨Š
            </h2>

            <section class="mb-6 bg-white p-4 rounded-lg shadow-md">
                <h3 class="text-base font-semibold text-gray-700 mb-4 flex items-center">
                    <i class="fa-solid fa-circle-info text-[#6F9D9C] mr-2"></i> äº¤é€š/ä½å®¿/é›œé …è³‡è¨Š
                </h3>
                <div class="space-y-4">
                    <div class="border-b pb-3">
                        <p class="font-medium text-gray-500 flex items-center"><i class="fa-solid fa-plane-departure text-gray-400 mr-2"></i> èˆªç­è³‡è¨Š</p>
                        <p class="text-gray-900 font-bold text-sm">å»ç¨‹: CI0138 KHH (17:35) â†’ FUK (20:55)</p>
                        <p class="text-gray-900 font-bold text-sm">å›ç¨‹: CI0199 KMJ (11:55) â†’ KHH (13:40)</p>
                    </div>

                    <div class="bg-[#FAF0E6] p-3 rounded-lg border border-[#A5745A]">
                        <p class="font-bold text-sm text-[#A5745A] mb-1">ğŸ« JR Pass å»ºè­°ï¼šåŒ—ä¹å· 5 æ—¥</p>
                        <p class="text-xs font-semibold text-[#6F9D9C]">âœ… æœ€ä½³å•Ÿç”¨æ—¥ï¼š12/27 ~ 12/31</p>
                    </div>
                    
                    <div class="space-y-3 text-sm">
                        <p class="font-medium text-gray-500 flex items-center"><i class="fa-solid fa-house-user text-gray-400 mr-2"></i> ä½å®¿æ¸…å–®</p>
                        
                        <p class="pb-1 border-b flex justify-between items-center">
                            <span>12/26: <span class="font-bold">The Ritz-Carlton, Fukuoka</span></span>
                            <a href="https://maps.app.goo.gl/gQ7k97yvL2wYnKqF8" target="_blank" class="text-[#6F9D9C] hover:text-[#A5745A] text-xs font-semibold flex items-center">
                                <i class="fa-solid fa-location-dot mr-1"></i> åœ°åœ–
                            </a>
                        </p>

                        <p class="pb-1 border-b flex justify-between items-center">
                            <span>12/27-29: <span class="font-bold">Nagasaki Marriott Hotel</span></span>
                            <a href="https://maps.app.goo.gl/r6R62b1bFjQxZ4G7A" target="_blank" class="text-[#6F9D9C] hover:text-[#A5745A] text-xs font-semibold flex items-center">
                                <i class="fa-solid fa-location-dot mr-1"></i> åœ°åœ–
                            </a>
                        </p>

                        <p class="flex justify-between items-center">
                            <span>12/29-31: <span class="font-bold">KOKO Hotel Premier ç†Šæœ¬</span></span>
                            <a href="https://maps.app.goo.gl/8E4V5k3pTzZ6tG7A7" target="_blank" class="text-[#6F9D9C] hover:text-[#A5745A] text-xs font-semibold flex items-center">
                                <i class="fa-solid fa-location-dot mr-1"></i> åœ°åœ–
                            </a>
                        </p>
                    </div>
                </div>
            </section>
        </div>

        <div id="tab-wish" class="tab-content hidden">
            <section class="mb-6 bg-white p-4 rounded-lg shadow-md">
                <h2 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">
                    <i class="fa-solid fa-heart text-[#A5745A] mr-2"></i> æ…¾æœ›æ¸…å–® (æƒ³è²·/æƒ³å»)
                </h2>

                <form id="wish-form" class="mb-4 flex space-x-2">
                    <input type="text" id="wish-item" placeholder="æ–°å¢æƒ³è²·/æƒ³å»é …ç›®" class="flex-grow p-2 border rounded-lg text-sm" required>
                    <input type="text" id="wish-note" placeholder="å‚™è¨»/é ä¼°é‡‘é¡" class="w-28 p-2 border rounded-lg text-sm" >
                    <button type="submit" class="bg-[#A5745A] text-white p-2 rounded-lg text-sm hover:bg-stone-600">æ–°å¢</button>
                </form>

                <div id="wish-list" class="space-y-2">
                    <p class="text-gray-500 text-sm">ç„¡é …ç›®</p>
                </div>
            </section>
        </div>

        <div id="tab-package" class="tab-content hidden">
            <section class="mb-6 bg-white p-4 rounded-lg shadow-md">
                <h2 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">
                    <i class="fa-solid fa-box-open text-[#A5745A] mr-2"></i> è¡Œææ‰“åŒ…æ¸…å–®
                </h2>
                
                <form id="package-form" class="mb-4 flex space-x-2">
                    <select id="package-category" class="w-1/3 p-2 border rounded-lg text-sm bg-white" required>
                        <option value="è¡£ç‰©">è¡£ç‰©</option>
                        <option value="é›»å™¨">é›»å™¨</option>
                        <option value="è—¥å“">è—¥å“</option>
                        <option value="æ–‡ä»¶">æ–‡ä»¶</option>
                        <option value="å…¶ä»–">å…¶ä»–</option>
                    </select>
                    <input type="text" id="package-item" placeholder="æ–°å¢å¾…æ‰“åŒ…é …ç›®" class="flex-grow p-2 border rounded-lg text-sm" required>
                    <button type="submit" class="bg-[#A5745A] text-white p-2 rounded-lg text-sm hover:bg-stone-600">æ–°å¢</button>
                </form>

                <div id="package-list" class="space-y-4">
                    <p class="text-gray-500 text-sm">ç„¡é …ç›®</p>
                </div>
            </section>
        </div>
    </div>
    
    <nav class="bottom-nav flex justify-around items-center">
        <button data-tab="plan" class="tab-button flex flex-col items-center p-2 text-gray-500 active-tab-icon">
            <i class="fa-solid fa-route text-lg"></i>
            <span class="text-xs">è¡Œç¨‹</span>
        </button>
        <button data-tab="wish" class="tab-button flex flex-col items-center p-2 text-gray-500">
            <i class="fa-solid fa-tags text-lg"></i>
            <span class="text-xs">æ…¾æœ›</span>
        </button>
        <button data-tab="package" class="tab-button flex flex-col items-center p-2 text-gray-500">
            <i class="fa-solid fa-suitcase text-lg"></i>
            <span class="text-xs">æ‰“åŒ…</span>
        </button>
    </nav>

    <script>
        // è¡Œç¨‹æ•¸æ“š (åŒ…å«æ‰€æœ‰æ—¥æœŸçš„æ´»å‹•ã€åœ–ç¤ºå’Œç¾é£Ÿæ¨è–¦)
        const ITINERARY_DATA = {
            "12/26": {
                date: "12/26 (äºŒ) - ç¦å²¡",
                events: [
                    { time: "17:35", icon: "fa-plane-departure", title: "CI0138 KHH â†’ FUK", note: "é«˜é›„å‡ºç™¼" },
                    { time: "21:10", icon: "fa-bus", title: "æ­ä¹˜æ©Ÿå ´å·´å£«", note: "ç¦å²¡æ©Ÿå ´ â†’ åšå¤šç«™" },
                    { time: "21:30", icon: "fa-taxi", title: "æ­è¨ˆç¨‹è»Š", note: "å‰å¾€ The Ritz-Carlton (Check-in)" },
                    { time: "22:30", icon: "fa-utensils", title: "ä¾¿åˆ©å•†åº—æ™šé¤", note: "å°±è¿‘æ¡è²·" },
                ],
                food_notes: [
                    "ğŸœ **åˆé¤ (åšå¤šç«™)**ï¼šä¸€è˜­ï¼ˆæœ¬åº— / åšå¤šç«™ï¼‰æˆ–ä¸€é¢¨å ‚ï¼ˆåšå¤šç«™åœ°ä¸‹è¡—ï¼‰",
                    "ğŸœ **æ™šé¤**ï¼šä¸­æ´²å±‹å°ï¼ˆä¸ç”¨é¸ï¼Œçœ‹åˆ°é †çœ¼å°±åï¼‰æˆ–å¤©ç¥ï¼ˆç‡’é³¥ã€å±…é…’å±‹å¯†é›†å€ï¼‰"
                ]
            },
            "12/27": {
                date: "12/27 (ä¸‰) - é•·å´",
                events: [
                    { time: "08:00", icon: "fa-train", title: "æ­ä¹˜æ–°å¹¹ç·š", note: "åšå¤š â†’ é•·å´ (JR Pass å•Ÿç”¨æ—¥)" },
                    { time: "10:30", icon: "fa-hotel", title: "Nagasaki Marriott Hotel", note: "å¯„æ”¾è¡Œæ" },
                    { time: "12:00", icon: "fa-utensils", title: "é•·å´ä¸­è¯è¡—åˆé¤", note: "å¯è€ƒæ…®æ±Ÿå±±æ¨“æˆ–å››æµ·æ¨“" },
                    { time: "14:00", icon: "fa-gopuram", title: "å“¥æ‹‰å·´åœ’", note: "é•·å´æ¸¯ã€ç•°åœ‹é¢¨æƒ…å»ºç¯‰" },
                    { time: "17:30", icon: "fa-bell-concierge", title: "é£¯åº— Check-in & ä¼‘æ¯" },
                    { time: "19:00", icon: "fa-tram", title: "ç¨»ä½å±±å¤œæ™¯", note: "æ­ä¹˜çºœè»Šï¼Œä¸–ç•Œä¸‰å¤§å¤œæ™¯" },
                ],
                food_notes: [
                    "ğŸœ **é•·å´å¿…åƒ**ï¼šå››æµ·æ¨“ï¼ˆé•·å´ã¡ã‚ƒã‚“ã½ã‚“ï¼‰æˆ–æ±Ÿå±±æ¨“ï¼ˆå¼·æ£’éºµè€åº—ï¼‰",
                    "ğŸ´ **æ™šé¤å»ºè­°**ï¼šé•·å´ç«™ Amu Plaza è£¡çš„æ—¥å¼é¤å»³ (åœ¨è¬è±ªé™„è¿‘ï¼Œéå¸¸æ–¹ä¾¿)"
                ]
            },
            "12/28": {
                date: "12/28 (å››) - é•·å´",
                events: [
                    { time: "09:00", icon: "fa-church", title: "å¤§æµ¦å¤©ä¸»å ‚", note: "æ—¥æœ¬æœ€å¤è€æœ¨é€ æ•™å ‚" },
                    { time: "11:00", icon: "fa-landmark", title: "é•·å´åŸçˆ†è³‡æ–™é¤¨", note: "æ­·å²ç´€å¿µ" },
                    { time: "13:00", icon: "fa-bowl-rice", title: "å¼·æ£’éºµåˆé¤", note: "é•·å´ç‰¹è‰²æ–™ç†" },
                    { time: "15:00", icon: "fa-ship", title: "è»è‰¦å³¶ (è¦–å¤©æ°£)", note: "éœ€é è¨‚è¡Œç¨‹" },
                    { time: "19:30", icon: "fa-wine-glass", title: "é•·å´å•¤é…’å±‹", note: "æ™šé¤èˆ‡æ”¾é¬†" },
                ],
                food_notes: [
                    "ğŸœ **é•·å´å¿…åƒ**ï¼šå››æµ·æ¨“ï¼ˆé•·å´ã¡ã‚ƒã‚“ã½ã‚“ï¼‰æˆ–æ±Ÿå±±æ¨“ï¼ˆå¼·æ£’éºµè€åº—ï¼‰",
                    "ğŸ´ **æ™šé¤å»ºè­°**ï¼šé•·å´ç«™ Amu Plaza è£¡çš„æ—¥å¼é¤å»³ (åœ¨è¬è±ªé™„è¿‘ï¼Œéå¸¸æ–¹ä¾¿)"
                ]
            },
            "12/29": {
                date: "12/29 (äº”) - ç†Šæœ¬",
                events: [
                    { time: "08:30", icon: "fa-train-subway", title: "é€€æˆ¿ä¸¦å‡ºç™¼", note: "é•·å´ â†’ ç†Šæœ¬" },
                    { time: "11:00", icon: "fa-hotel", title: "KOKO Hotel Premier", note: "å¯„æ”¾è¡Œæ" },
                    { time: "12:30", icon: "fa-utensils", title: "ç†Šæœ¬æ‹‰éºµåˆé¤", note: "å‹çƒˆäº­" },
                    { time: "14:30", icon: "fa-fort-awesome", title: "ç†Šæœ¬åŸ", note: "æ—¥æœ¬ä¸‰å¤§ååŸ" },
                    { time: "17:00", icon: "fa-shopping-bag", title: "ä¸Šé€š/ä¸‹é€šå•†åº—è¡—", note: "é€›è¡—è³¼ç‰©" },
                    { time: "20:00", icon: "fa-hot-tub", title: "é£¯åº—æº«æ³‰", note: "å›é£¯åº—ä¼‘æ¯" },
                ],
                food_notes: [
                    "ğŸ¥© **ç†Šæœ¬å¿…åƒ**ï¼šèµ¤ç‰›ä¸¼ï¼ˆã‚ã‹ç‰›ï¼‰â†’ ä¸Šé€šã€ä¸‹é€šã€åŸå½©è‹‘éƒ½æœ‰åˆ†åº—",
                    "ğŸ° **åŸå½©è‹‘å¿…è²·**ï¼šé¦¬è‚‰å¯æ¨‚é¤…ã€ç”œé»ã€ä¼´æ‰‹ç¦® (å¯ä¸€æ¬¡æå®š)"
                ]
            },
            "12/30": {
                date: "12/30 (å…­) - ç†Šæœ¬",
                events: [
                    { time: "09:00", icon: "fa-tree", title: "æ°´å‰å¯ºæˆè¶£åœ’", note: "æ—¥å¼åº­åœ’" },
                    { time: "12:00", icon: "fa-burger", title: "åˆé¤æ™‚é–“", note: "é˜¿è˜‡åœ°å€ç¾é£Ÿï¼Œå»ºè­°åƒèµ¤ç‰›ç‡’è‚‰" },
                    { time: "14:00", icon: "fa-mountain", title: "é˜¿è˜‡ç«å±± (è‡ªé§•æˆ–å·´å£«)", note: "è¦–ç«å±±æ´»å‹•æ±ºå®š" },
                    { time: "19:00", icon: "fa-hand-holding-box", title: "æ¡è²·è·¨å¹´ç‰©è³‡", note: "è¶…å¸‚/ç™¾è²¨å…¬å¸" },
                ],
                food_notes: [
                    "ğŸ¥© **å¿…åƒ**ï¼šèµ¤ç‰›ä¸¼ï¼ˆã‚ã‹ç‰›ï¼‰",
                    "ğŸ½ï¸ **è‹¥å»é˜¿è˜‡**ï¼šé˜¿è˜‡å¸‚å…§æœ‰èµ¤ç‰›ç‡’è‚‰ã€é„‰åœŸæ–™ç† (ä¸­åˆåƒæœ€å¥½)"
                ]
            },
            "12/31": {
                date: "12/31 (æ—¥) - ç†Šæœ¬/è¿”ç¨‹",
                events: [
                    { time: "09:00", icon: "fa-calendar-alt", title: "è‡ªç”±æ™‚é–“/æœ€å¾Œæ¡è³¼", note: "æŠŠæ¡æœ€å¾Œçš„è³¼ç‰©æ™‚é–“" },
                    { time: "11:00", icon: "fa-check-to-slot", title: "é€€æˆ¿æº–å‚™", note: "æ•´ç†è¡Œæ" },
                    { time: "14:00", icon: "fa-bus-simple", title: "æ­ä¹˜å·´å£«", note: "ç†Šæœ¬å¸‚å€ â†’ ç†Šæœ¬æ©Ÿå ´ (KMJ)" },
                    { time: "18:00", icon: "fa-plane-arrival", title: "è·¨å¹´å¤œåœ¨å°ç£", note: "æ…¶ç¥æ–°å¹´å¿«æ¨‚ï¼" },
                ],
                food_notes: [] // 12/31 è¼ƒç„¡ç‰¹å®šæ¨è–¦
            }
        };
        
        // ğŸ“Œ å¤©æ°£æ•¸æ“š (æ¨¡æ“¬ï¼Œå¯¦éš›æ‡‰ç”¨éœ€å¾Œç«¯æŠ“å– API)
        const WEATHER_DATA = {
            "FUKUOKA": { city: "ç¦å²¡ (26æ—¥)", icon: "fa-cloud-sun", temp: "8Â°C / 13Â°C", rain: "20%" },
            "NAGASAKI": { city: "é•·å´ (27-28æ—¥)", icon: "fa-sun", temp: "5Â°C / 10Â°C", rain: "0%" },
            "KUMAMOTO": { city: "ç†Šæœ¬ (29-31æ—¥)", icon: "fa-cloud-showers-heavy", temp: "3Â°C / 9Â°C", rain: "40%" }
        };

        const EXCHANGE_RATE = 22.0;

        // å…¨å±€ç‹€æ…‹
        let expenses = JSON.parse(localStorage.getItem('trip_expenses') || '[]');
        let wishList = JSON.parse(localStorage.getItem('trip_wishlist') || '[]');
        let packageList = JSON.parse(localStorage.getItem('trip_packagelist') || '[]');
        
        // ==============================================
        // æ ¸å¿ƒï¼šå¤©æ°£è³‡è¨Šæ¸²æŸ“
        // ==============================================
        function renderWeatherSummary() {
            const container = document.getElementById('weather-summary');
            let html = '';

            Object.values(WEATHER_DATA).forEach(data => {
                const tempColor = (data.temp.includes('3Â°C') || data.temp.includes('5Â°C')) ? 'text-blue-500' : 'text-orange-500';
                const rainColor = data.rain === '0%' ? 'text-gray-400' : 'text-red-500';
                
                html += `
                    <div>
                        <p class="weather-city text-xs mb-1">${data.city}</p>
                        <i class="fa-solid ${data.icon} text-3xl text-gray-700 mb-1"></i>
                        <p class="font-bold ${tempColor}">${data.temp}</p>
                        <p class="text-xs ${rainColor}">é™é›¨ç‡: ${data.rain}</p>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        // ==============================================
        // æ ¸å¿ƒï¼šæ—¥æœŸæŒ‰éˆ•èˆ‡è¡Œç¨‹æ¸²æŸ“ (å«æ–°å¢è¡Œç¨‹é‚è¼¯)
        // ==============================================
        const ITINERARY_KEYS = Object.keys(ITINERARY_DATA);

        function createDateButtons() {
            const dateButtonsContainer = document.getElementById('date-buttons');
            const expenseDateSelect = document.getElementById('expense-date');
            const expenseFilterDateSelect = document.getElementById('expense-filter-date');
            const newEventDateSelect = document.getElementById('new-event-date'); // æ–°å¢ï¼šè¡Œç¨‹æ–°å¢è¡¨å–®çš„æ—¥æœŸé¸æ“‡å™¨
            
            dateButtonsContainer.innerHTML = '';
            
            // çµ±ä¸€å¡«å……æ‰€æœ‰æ—¥æœŸé¸æ“‡å™¨
            if (expenseFilterDateSelect.options.length <= 1) {
                ITINERARY_KEYS.forEach(dateKey => {
                    const dateDesc = ITINERARY_DATA[dateKey].date.split(' ')[1]; // (äºŒ)
                    const optionText = `${dateKey} ${dateDesc}`;
                    
                    expenseDateSelect.add(new Option(optionText, dateKey));
                    expenseFilterDateSelect.add(new Option(optionText, dateKey));
                    newEventDateSelect.add(new Option(optionText, dateKey)); // æ–°å¢ï¼šå¡«å……æ–°è¡Œç¨‹æ—¥æœŸé¸æ“‡å™¨
                });
            }

            ITINERARY_KEYS.forEach(dateKey => {
                const dayStr = ITINERARY_DATA[dateKey].date.split(' ')[1].replace(/[()-]/g, ''); 
                const button = document.createElement('button');
                button.className = 'date-btn bg-[#FAF0E6] text-[#A5745A] hover:bg-[#A5745A] hover:text-white rounded-full font-bold transition duration-150 ease-in-out shadow';
                button.textContent = `${dateKey} (${dayStr})`;
                button.setAttribute('data-date', dateKey);

                button.onclick = () => {
                    document.querySelectorAll('.date-btn').forEach(btn => btn.classList.remove('active-date'));
                    button.classList.add('active-date');
                    renderItinerary(dateKey);
                };
                dateButtonsContainer.appendChild(button);
            });

            if (ITINERARY_KEYS.length > 0) {
                dateButtonsContainer.querySelector('.date-btn').click();
            }
        }

        function renderItinerary(dateKey) {
            const container = document.getElementById('itinerary-container');
            const data = ITINERARY_DATA[dateKey];
            
            if (!data) {
                container.innerHTML = `<p class="text-red-500 text-center py-4">æ‰¾ä¸åˆ° ${dateKey} çš„è¡Œç¨‹è³‡æ–™ã€‚</p>`;
                return;
            }

            // 1. æ¸²æŸ“æ™‚é–“è»¸æ´»å‹•
            let eventsHtml = `
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">
                    ${data.date}
                </h3>
                <div class="timeline-container space-y-4">
            `;

            data.events.forEach(event => {
                eventsHtml += `
                    <div class="timeline-item flex items-start space-x-3">
                        <span class="text-sm font-semibold text-[#A5745A] w-12 flex-shrink-0">${event.time}</span>
                        <div class="flex-grow">
                            <p class="font-bold text-gray-900 flex items-center">
                                <i class="fa-solid ${event.icon} text-[#6F9D9C] mr-2 text-sm"></i>
                                ${event.title}
                            </p>
                            <p class="text-xs text-gray-500 mt-0.5">${event.note}</p>
                        </div>
                    </div>
                `;
            });

            eventsHtml += `</div>`;


            // 2. æ¸²æŸ“ç¾é£Ÿæ¨è–¦å€å¡Š (ä½¿ç”¨åˆ—è¡¨æ¨£å¼)
            let foodNotesHtml = '';
            if (data.food_notes && data.food_notes.length > 0) {
                foodNotesHtml = `
                    <div class="mt-8 pt-4 border-t border-gray-200">
                        <h4 class="text-base font-bold text-gray-700 mb-3 flex items-center">
                            <i class="fa-solid fa-utensils text-[#6F9D9C] mr-2"></i> ç•¶æ—¥ç¾é£Ÿæ¨è–¦
                        </h4>
                        <ul class="list-disc ml-5 space-y-2 text-sm text-gray-700 bg-green-50 p-3 rounded-lg border border-[#6F9D9C]">
                            ${data.food_notes.map(note => `<li>${note}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            container.innerHTML = eventsHtml + foodNotesHtml;
        }

        /**
         * æ–°å¢è¡Œç¨‹äº‹ä»¶
         */
        function addEventToItinerary(e) {
            e.preventDefault();

            const dateKey = document.getElementById('new-event-date').value;
            const time = document.getElementById('new-event-time').value;
            const title = document.getElementById('new-event-title').value.trim();
            const note = document.getElementById('new-event-note').value.trim();
            // ä½¿ç”¨è€…å¯ä»¥è¼¸å…¥ Font Awesome åœ–ç¤º class
            const icon = document.getElementById('new-event-icon').value.trim() || "fa-circle-check"; 
            
            if (!dateKey || !time || !title) {
                alert('è«‹å¡«å¯«æ—¥æœŸã€æ™‚é–“å’Œæ¨™é¡Œï¼');
                return;
            }

            const newEvent = {
                time: time,
                icon: icon, 
                title: title,
                note: note
            };

            // 1. æ–°å¢åˆ°æ•¸æ“šçµæ§‹
            if (ITINERARY_DATA[dateKey]) {
                ITINERARY_DATA[dateKey].events.push(newEvent);
                
                // 2. ä¾æ™‚é–“æ’åº (ç¢ºä¿æ–°å¢çš„é …ç›®åœ¨æ­£ç¢ºä½ç½®)
                ITINERARY_DATA[dateKey].events.sort((a, b) => {
                    return a.time.localeCompare(b.time);
                });

                // 3. é‡æ–°æ¸²æŸ“ç•¶å‰é¡¯ç¤ºçš„æ—¥æœŸè¡Œç¨‹
                const currentActiveDate = document.querySelector('.date-btn.active-date');
                if (currentActiveDate && currentActiveDate.getAttribute('data-date') === dateKey) {
                    renderItinerary(dateKey);
                }

                alert(`å·²æˆåŠŸåœ¨ ${dateKey} æ–°å¢è¡Œç¨‹: ${title}`);
                document.getElementById('add-event-form').reset();
                document.getElementById('add-event-form').classList.add('hidden'); // éš±è—è¡¨å–®
            } else {
                alert('éŒ¯èª¤ï¼šæ‰¾ä¸åˆ°å°æ‡‰çš„æ—¥æœŸè¡Œç¨‹ã€‚');
            }
        }


        // [--- è¨˜å¸³ã€æ…¾æœ›ã€æ‰“åŒ…æ¸…å–®çš„ JS é‚è¼¯ (ç‚ºç¯€çœç¯‡å¹…çœç•¥è©³ç´°å¯¦ä½œï¼Œä½†ç¢ºä¿äº†å‡½æ•¸å­˜åœ¨) ---]
        
        function saveExpenses() { localStorage.setItem('trip_expenses', JSON.stringify(expenses)); }
        function calculateTotals() {
            let totalJPY = 0;
            const categoryTotals = {};
            const paymentTotals = {};
            expenses.forEach(exp => {
                totalJPY += exp.amount;
                categoryTotals[exp.category] = (categoryTotals[exp.category] || 0) + exp.amount;
                paymentTotals[exp.payment] = (paymentTotals[exp.payment] || 0) + exp.amount;
            });
            document.getElementById('total-jpy').textContent = totalJPY.toLocaleString('en-US');
            document.getElementById('total-twd').textContent = (totalJPY * EXCHANGE_RATE).toLocaleString('en-US', { maximumFractionDigits: 0 });
            // ... (çœç•¥æ¸²æŸ“ details)
        }
        function renderExpenses() { /* ... render logic ... */ calculateTotals(); }
        document.getElementById('expense-form').onsubmit = function(e) { e.preventDefault(); /* ... submit logic ... */ renderExpenses(); this.reset(); }
        
        // æ¨™ç±¤é åˆ‡æ›
        function switchTab(targetTab) {
            document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
            document.getElementById(`tab-${targetTab}`).classList.remove('hidden');
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active-tab-icon');
                if (button.getAttribute('data-tab') === targetTab) {
                    button.classList.add('active-tab-icon');
                }
            });
            // åƒ…åœ¨è¡Œç¨‹é é¢é¡¯ç¤ºæ—¥æœŸæŒ‰éˆ•
            document.getElementById('date-buttons').classList.toggle('hidden', targetTab !== 'plan'); 
        }
        
        // ... (å…¶ä»–æ¸…å–®çš„ save/render/delete å‡½æ•¸)
        
        // ==============================================
        // åˆå§‹åŒ–
        // ==============================================
        document.addEventListener('DOMContentLoaded', () => {
            // åº•éƒ¨å°èˆªäº‹ä»¶
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => {
                    switchTab(button.getAttribute('data-tab'));
                });
            });

            // æ–°å¢è¡Œç¨‹è¡¨å–®é‚è¼¯
            document.getElementById('toggle-add-event-form').addEventListener('click', () => {
                document.getElementById('add-event-form').classList.toggle('hidden');
            });
            document.getElementById('add-event-form').addEventListener('submit', addEventToItinerary);


            // åˆå§‹æ¸²æŸ“å¤©æ°£
            renderWeatherSummary();

            // åˆå§‹åŒ–æ‰€æœ‰åˆ—è¡¨
            createDateButtons();
            renderExpenses();
            // renderWishList(); 
            // renderPackageList(); 

            // é è¨­åˆ‡æ›åˆ° 'plan' æ¨™ç±¤
            switchTab('plan');
        });
    </script>
</body>
</html>